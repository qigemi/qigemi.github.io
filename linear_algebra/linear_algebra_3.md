---
layout: post
---


# 10.正交和投影
## 正交
我们说两个向量正交，即两个向量的夹角是90度。两向量正交当且仅当 $x^Ty=0$ 。所以零向量和任意向量正交。

子空间正交，即子空间中任意向量都与另一个子空间的所有向量正交。可以想象一个平面和垂直于它的直线，两者都是一个子空间，这两个子空间是正交的。一个更美妙的例子是，矩阵的行空间和零空间正交。proof：  
$R(A)=yA,N(A)=\{x|Ax=0\}$，任取行空间和零空间中的两个向量相乘，$(yA)x=y(Ax)=y\cdot0=0$。所以两个子空间中的任意两向量都是正交的，两子空间正交。同样可以证明矩阵列空间和左零空间正交，只要把A转置就行了。

行空间和零空间正交，而且它们的维数相加正好是矩阵列数n，它们刚好可以张成完整的空间$R^n$，所以我们也会称它们互为正交补集。换句话说，**零空间包含了所有与行空间正交的向量**。四个基本子空间比我想象的更美一些。

## 投影，再解Ax=b
基于正交，我们继续讨论如果Ax=b无解，那么怎么得到一个尽量好的解。一般什么情况下无解呢，本质上是b不在A的列空间中，实际应用中一般是统计或者测量时，有于多次测量我们列出很多方程，A的列空间维数很大，但是生成列空间的向量数量却很少，这样Ax显然不能得到所有 $R^m$ 空间中的向量，测量中的噪声会让b落在列空间之外。此时我们需要投影这一操作，将b投影到A的列空间，求一个近似解。

我们先从一维投影了解投影矩阵。求向量b在向量a上的投影，设投影结果向量为p，因为p在a上，所以可以表示为a的x倍的形式 $p=xa$，残差向量为 $e=b-p$ 。原谅我没有画图，可以自己画一下。e垂直于a，由正交关系有 $e^T\cdot a=0$，推出

$$x=\frac{a^Tb}{a^Ta},p=a\frac{a^Tb}{a^Ta}$$

由p的形式可以看出，p会随着b变化，而a的长度变化则不会影响p。还可以看出投影可以通过一个矩阵表示，这说明它是一个线性变换（注意等距的点投影到a上还是等距的）。记投影矩阵为

$$P=\frac{aa^T}{a^Ta}$$

当向量a确定后，投影矩阵就确定了，向量b在a上的投影结果为 $Pb$。P的性质包括，
1. 它是一个秩一矩阵，显然它的列空间就是向量a所在的直线，是一维的。
2. $P^n=P$，因为投影结果再投影还是向量p。
3. P是对阵矩阵。

好了，我们知道如何求向直线投影的投影矩阵，那么如何求向平面或子空间投影的投影矩阵呢？别忘了我们是要求解Ax=b的近似解的，我们需要将b投影到A的列空间。我们还是像一维投影那样假设，有投影结果p和残差向量e，只不过p现在要用子空间的基表示，在这里是A的列空间的基，可以表示为 $p=A\hat x$，即p为A的列的线性组合。再由e和子空间的垂直关系可得：

$$\begin{align}
A & =[a_1 a_2],a_1^Te=0,a_2^Te=0 \\
  & \Rightarrow \left[ \begin{matrix} a_1^T \\ a_2^T \end{matrix} \right]\left[ \begin{matrix} b-A\hat x \end{matrix} \right]=\left[ \begin{matrix} 0\\0 \end{matrix} \right] \\
 & \Rightarrow A^T(b-A\hat x)=A^T\cdot e=0 \\
 & \Rightarrow A^TA\hat x=A^Tb
 \end{align}$$

最后一个式子叫做正规方程。注意倒数第二个式子，残差e垂直于A的列空间，所以在A的零空间中。当然最重要的是我们得到了投影矩阵。到这里要注意了，**我们需要假设 $A^TA$ 可逆**，后面再说不可逆怎么办。下面的推导都是在该假设下成立的 。我们可以得到
1. $\hat x=(A^TA)^{-1}A^Tb$
1. 投影 $p=A\hat x=A(A^TA)^{-1}A^Tb$
2. projection matrix: $P=A(A^TA)^{-1}A^T$

注意A不是方阵，所以P的表达式不能进一步化简。而如果A是可逆阵，则P可化简为I，因为可逆矩阵的列空间就是整个空间，任意向量向A的列空间投影就是它本身。同样的，P有性质 $P^T=P,P^2=P$，只不过它不一定是秩一矩阵了，因为列空间不一定是一维。

再次强调上述结果的前提是 $A^TA$ 可逆，这需要A是列满秩的。

## 最小二乘
投影的一种应用是最小二乘，当我们的优化目标是使 $\|Ax-b\|^2=\|e\|^2$ 最小时，就是使Ax等于b在A列空间上的投影，因为此时残差垂直于列空间，取最小值。

## 正交基，正交矩阵，施密特正交化
一组正交向量（orthogonal vectors），即每个向量都与其他所有向量正交。不妨设它们都是单位向量，这样一组向量又叫标准正交向量（orthonormal vectors），可以记为 $q_1,q_2,...,q_n$ ,且有：

$$q_i^Tq_j=\left\{\begin{align} 0,i\neq j \\ 1,i=j  \end{align}\right.$$

将一组标准正交向量作为列组成一个矩阵Q，则有 $Q^TQ=I$ ，注意**我们一般只在Q是方阵的时候叫它正交矩阵**，因为此时它有一个更好的性质 $Q^T=Q^{{-1}}$。为了方便，我们下面说Q的时候就指的是由单位正交向量组成的矩阵。

Q有一些很好的性质，比如
1. 如果要投影到Q的列空间，投影矩阵为 $P=Q(Q^TQ)^{-1}Q^T=QQ^T$ ，如果Q是方阵，则 $P=I$。
2. 如果正规方程中的A是Q，则可化简为 $\hat x=Q^Tb$，不需要求逆了。

我们如何得到一个Q呢？一组线性无关的向量可以通过Gram-Schmidt正交化为一组单位正交向量。施密特正交化的过程为，选定其中一个向量单位化为第一个正交基，依次处理剩下的向量，将当前向量在已有正交基上的分量都减掉，这样就得到了垂直于目前所有正交基的部分，再将其单位化就得到了下一个基向量。以此类推得到所有的单位正交基。公式我就不写了，理解这个原理就好。

我们对矩阵A的列向量做施密特正交化，可以得到矩阵Q，两矩阵有如下关系

$$A=QR$$

**这就是著名的QR分解**。其中Q是由单位正交向量组成的矩阵，R是上三角方阵。  
**矩阵消元对应LU分解，施密特正交化对应QR分解。** 完美。
